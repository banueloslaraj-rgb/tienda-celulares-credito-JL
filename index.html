<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Celulares JL - Venta de Celulares a Crédito con Sistema MDM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // Inicializar EmailJS
        emailjs.init('WY8SuQs3NOXkc5je2');  //L6MM6O9uYt9zG8S32
    </script>
    
    <!-- Firebase SDK -->
    <script type="module">
        // Importar Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, deleteDoc, onSnapshot, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDVs8vcmrbiQHvVKoKCrbaM4qJiryGvYx4",
            authDomain: "celularesjl-c86dc.firebaseapp.com",
            projectId: "celularesjl-c86dc",
            storageBucket: "celularesjl-c86dc.firebasestorage.app",
            messagingSenderId: "641672688811",
            appId: "1:641672688811:web:c6f97887d0ba53231c73ee"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Hacer disponible globalmente
        window.firebaseApp = app;
        window.firestoreDB = db;
        window.firebaseModules = { 
            collection, addDoc, getDocs, updateDoc, doc, deleteDoc, onSnapshot, setDoc 
        };
        
        console.log("✅ Firebase configurado correctamente");
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        .section-padding {
            padding: 80px 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 50px;
            font-size: 2.5rem;
            color: var(--secondary);
            position: relative;
        }
        
        .section-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: var(--primary);
            margin: 15px auto;
            border-radius: 2px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            padding: 12px 25px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-accent {
            background-color: var(--accent);
        }
        
        .btn-accent:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        /* Panel de Administración MDM */
        .admin-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
        }

        .admin-login {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 0 auto;
        }

        .admin-login h2 {
            color: var(--secondary);
            text-align: center;
            margin-bottom: 30px;
        }

        .admin-panel {
            display: none;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .admin-header {
            background: var(--secondary);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: var(--light);
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            color: var(--secondary);
            font-size: 0.9rem;
        }

        .admin-content {
            padding: 30px;
        }

        .device-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .device-header {
            background: var(--light);
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            font-weight: bold;
            color: var(--secondary);
        }

        .device-item {
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            align-items: center;
            border-bottom: 1px solid #eee;
            color: #333;
        }

        .device-item:last-child {
            border-bottom: none;
        }

        .device-item:hover {
            background-color: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-active {
            background: #e8f5e8;
            color: var(--success);
        }

        .status-blocked {
            background: #ffeaea;
            color: var(--accent);
        }

        .status-pending {
            background: #fff3cd;
            color: var(--warning);
        }

        .firebase-status {
            background: #2ecc71;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .firebase-offline {
            background: #e74c3c;
        }

        /* Header */
        header {
            background-color: white;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            color: var(--secondary);
            display: flex;
            align-items: center;
        }
        
        .logo i {
            color: var(--primary);
            margin-right: 10px;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 30px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--secondary);
            font-weight: 600;
            transition: color 0.3s;
            font-size: 1.05rem;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(44, 62, 80, 0.8), rgba(44, 62, 80, 0.9)), url('https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 120px 0;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 40px;
            opacity: 0.9;
        }
        
        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        /* Features */
        .features {
            background-color: white;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .feature-card {
            background: white;
            padding: 40px 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
        }
        
        .feature-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        /* Productos */
        .products {
            background-color: var(--light);
        }
        
        .products-filter {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active, .filter-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }
        
        .product-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .product-info {
            padding: 20px;
            position: relative;
        }
        
        .product-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .product-description {
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .product-features {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .product-features li {
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #555;
        }
        
        .product-features li i {
            color: var(--success);
            margin-right: 5px;
        }
        
        /* Calculadora de crédito */
        .calculator {
            background-color: white;
        }
        
        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }
        
        .calculator-form {
            background: var(--light);
            padding: 30px;
            border-radius: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .calculator-result {
            background: var(--secondary);
            color: white;
            padding: 30px;
            border-radius: 10px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .result-total {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-top: 20px;
        }
        
        /* Sección de Documentos */
        .documents-section {
            background: white;
            display: none;
        }

        .document-group {
            background: var(--light);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .document-header h4 {
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .document-required {
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .upload-area {
            border: 2px dashed var(--primary);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(52, 152, 219, 0.05);
        }

        .upload-area:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: #2980b9;
        }

        .upload-placeholder i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .upload-placeholder p {
            margin-bottom: 5px;
            color: var(--secondary);
            font-weight: 600;
        }

        .upload-placeholder small {
            color: #7f8c8d;
        }

        .upload-preview img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .file-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
            color: white;
        }

        .processing-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            color: var(--secondary);
            max-width: 400px;
        }

        .upload-progress {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s;
        }

        .success-message {
            text-align: center;
            padding: 40px;
            max-width: 500px;
            margin: 50px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        /* Testimonios */
        .testimonials {
            background: var(--light);
        }
        
        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .testimonial-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .testimonial-text {
            font-style: italic;
            margin-bottom: 20px;
            color: #555;
        }
        
        .testimonial-author {
            display: flex;
            align-items: center;
        }
        
        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }
        
        .author-info h4 {
            margin-bottom: 5px;
            color: var(--secondary);
        }
        
        .author-info p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        /* Footer */
        footer {
            background-color: var(--secondary);
            color: white;
            padding: 70px 0 20px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-column h3 {
            margin-bottom: 25px;
            font-size: 1.3rem;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-column h3:after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background: var(--primary);
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column ul li {
            margin-bottom: 12px;
        }
        
        .footer-column a {
            color: #bdc3c7;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-column a:hover {
            color: white;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .social-links a:hover {
            background: var(--primary);
            transform: translateY(-3px);
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #bdc3c7;
            font-size: 0.9rem;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }

            .device-header, .device-item {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .form-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                padding: 15px 0;
            }
            
            .nav-links {
                margin-top: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .nav-links li {
                margin: 0 10px 10px;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                max-width: 250px;
                text-align: center;
            }
            
            .section-title {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 576px) {
            .section-padding {
                padding: 60px 0;
            }
            
            .feature-card {
                padding: 30px 20px;
            }

            .admin-stats {
                grid-template-columns: 1fr;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav class="navbar">
                <div class="logo">
                    <i class="fas fa-mobile-alt"></i>
                    Celulares JL
                </div>
                <ul class="nav-links">
                    <li><a href="#inicio">Inicio</a></li>
                    <li><a href="#productos">Productos</a></li>
                    <li><a href="#credito">Crédito</a></li>
                    <li><a href="#admin">Administración MDM</a></li>
                    <li><a href="#contacto">Contacto</a></li>
                </ul>
                <a href="#credito" class="btn">Solicitar Crédito</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="inicio">
        <div class="container">
            <h1>Los Mejores Celulares a Crédito con Sistema MDM</h1>
            <p>Adquiere el smartphone que siempre has querido con nuestras facilidades de pago. Sistema de administración MDM integrado para tu seguridad.</p>
            <div class="hero-buttons">
                <a href="#productos" class="btn">Ver Catálogo</a>
                <a href="#credito" class="btn btn-outline">Calcular Crédito</a>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section class="features section-padding">
        <div class="container">
            <h2 class="section-title">¿Por Qué Elegirnos?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Sistema MDM Integrado</h3>
                    <p>Control total de dispositivos con nuestro sistema de Mobile Device Management. Bloqueo remoto en caso de impago.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <h3>Crédito Accesible</h3>
                    <p>Aprobación inmediata con documentos básicos. Planes desde 6 hasta 24 meses con tasas competitivas.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>Dispositivos Premium</h3>
                    <p>Trabajamos con las mejores marcas: Apple, Samsung, Xiaomi, Motorola y más. Garantía de 12 meses.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Productos -->
    <section class="products section-padding" id="productos">
        <div class="container">
            <h2 class="section-title">Catálogo de Productos</h2>
            <div class="products-filter">
                <button class="filter-btn active" data-filter="all">Todos</button>
                <button class="filter-btn" data-filter="apple">Apple</button>
                <button class="filter-btn" data-filter="samsung">Samsung</button>
                <button class="filter-btn" data-filter="xiaomi">Xiaomi</button>
                <button class="filter-btn" data-filter="motorola">Motorola</button>
            </div>
            <div class="products-grid" id="products-container">
                <!-- Los productos se cargarán aquí dinámicamente -->
            </div>
        </div>
    </section>

    <!-- Calculadora de Crédito -->
    <section class="calculator section-padding" id="credito">
        <div class="container">
            <h2 class="section-title">Calcula Tu Crédito</h2>
            <div class="calculator-container">
                <div class="calculator-form">
                    <form id="credit-form">
                        <div class="form-group">
                            <label for="product">Selecciona un producto</label>
                            <select id="product" required>
                                <option value="">Selecciona un celular</option>
                                <!-- Las opciones se llenarán dinámicamente -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="months">Plazo en meses</label>
                            <select id="months" required>
                                <option value="3">3 meses</option>
                                <option value="6">6 meses</option>
                                <option value="12" selected>12 meses</option>
                                <option value="18">18 meses</option>
                                <option value="24">24 meses</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="initial-payment">Pago inicial (opcional)</label>
                            <input type="number" id="initial-payment" placeholder="Ingresa el monto">
                        </div>
                        <button type="submit" class="btn">Calcular Cuota</button>
                    </form>
                </div>
                <div class="calculator-result" id="calculator-result">
                    <h3>Resumen de Financiamiento</h3>
                    <p>Selecciona un producto y completa el formulario para ver tu plan de pago personalizado.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Sección de Documentos para Crédito -->
    <section class="documents-section section-padding" id="documentos">
        <div class="container">
            <h2 class="section-title">Validación de Documentos</h2>
            
            <div id="sale-summary" style="background: var(--light); padding: 30px; border-radius: 10px; margin-bottom: 30px;">
                <h3 style="margin-bottom: 20px; color: var(--secondary);">Resumen de tu Solicitud</h3>
                <div id="sale-details"></div>
            </div>
            
            <div class="documents-container">
                <div class="document-upload">
                    <h3 style="margin-bottom: 20px; color: var(--secondary);">Sube tus Documentos</h3>
                    <p style="margin-bottom: 30px; color: #666;">Para procesar tu crédito, necesitamos los siguientes documentos:</p>
                    
                    <form id="document-upload-form">
                        <!-- INE/Identificación -->
                        <div class="document-group">
                            <div class="document-header">
                                <h4><i class="fas fa-id-card"></i> INE / Identificación Oficial</h4>
                                <span class="document-required">Requerido</span>
                            </div>
                            <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                                Sube una foto nítida de ambos lados de tu INE
                            </p>
                            <div class="upload-area" id="ine-upload-area">
                                <div class="upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                                    <p>Haz clic o arrastra tu INE aquí</p>
                                    <small>Formatos: JPG, PNG, PDF (Máx. 5MB)</small>
                                </div>
                                <input type="file" id="ine-front" accept="image/*,.pdf" style="display: none;">
                                <input type="file" id="ine-back" accept="image/*,.pdf" style="display: none;">
                            </div>
                            <div class="upload-preview" id="ine-preview" style="display: none; margin-top: 15px;">
                                <div class="preview-images" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <!-- Las previsualizaciones se agregarán aquí -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Comprobante de Domicilio -->
                        <div class="document-group">
                            <div class="document-header">
                                <h4><i class="fas fa-home"></i> Comprobante de Domicilio</h4>
                                <span class="document-required">Requerido</span>
                            </div>
                            <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                                Recibo de luz, agua, teléfono o estados de cuenta (no mayor a 3 meses)
                            </p>
                            <div class="upload-area" id="address-upload-area">
                                <div class="upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                                    <p>Haz clic o arrastra tu comprobante aquí</p>
                                    <small>Formatos: JPG, PNG, PDF (Máx. 5MB)</small>
                                </div>
                                <input type="file" id="address-proof" accept="image/*,.pdf" style="display: none;">
                            </div>
                            <div class="upload-preview" id="address-preview" style="display: none; margin-top: 15px;">
                                <!-- La previsualización se agregará aquí -->
                            </div>
                        </div>
                        
                        <!-- Selfie con INE -->
                        <div class="document-group">
                            <div class="document-header">
                                <h4><i class="fas fa-camera"></i> Selfie con tu INE</h4>
                                <span class="document-required">Requerido</span>
                            </div>
                            <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                                Toma una selfie sosteniendo tu INE junto a tu rostro
                            </p>
                            <div class="upload-area" id="selfie-upload-area">
                                <div class="upload-placeholder">
                                    <i class="fas fa-camera" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                                    <p>Haz clic o arrastra tu selfie aquí</p>
                                    <small>Formato: JPG, PNG (Máx. 5MB)</small>
                                </div>
                                <input type="file" id="selfie" accept="image/*" style="display: none;">
                            </div>
                            <div class="upload-preview" id="selfie-preview" style="display: none; margin-top: 15px;">
                                <!-- La previsualización se agregará aquí -->
                            </div>
                        </div>
                        
                        <!-- Información del Cliente -->
                        <div class="form-section" style="margin-top: 30px;">
                            <h4 style="margin-bottom: 20px; color: var(--secondary);">Información Personal</h4>
                            <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label for="client-fullname">Nombre Completo *</label>
                                    <input type="text" id="client-fullname" required>
                                </div>
                                <div class="form-group">
                                    <label for="client-phone">Teléfono *</label>
                                    <input type="tel" id="client-phone" required>
                                </div>
                                <div class="form-group">
                                    <label for="client-email">Correo Electrónico *</label>
                                    <input type="email" id="client-email" required>
                                </div>
                                <div class="form-group">
                                    <label for="client-curp">CURP</label>
                                    <input type="text" id="client-curp">
                                </div>
                                <div class="form-group" style="grid-column: span 2;">
                                    <label for="client-address">Dirección Completa *</label>
                                    <input type="text" id="client-address" required>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Botones -->
                        <div style="display: flex; gap: 20px; margin-top: 30px;">
                            <button type="button" class="btn btn-outline" onclick="goBackToCalculator()">
                                <i class="fas fa-arrow-left"></i> Regresar
                            </button>
                            <button type="submit" class="btn" id="submit-documents">
                                <i class="fas fa-paper-plane"></i> Enviar Documentos y Solicitar Crédito
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Panel de Administración MDM -->
    <section class="admin-section section-padding" id="admin">
        <div class="container">
            <h2 class="section-title" style="color: white;">Panel de Administración MDM 
                <span id="firebase-status" class="firebase-status">Conectado a Firebase</span>
            </h2>
            
            <!-- Login para Administradores -->
            <div class="admin-login" id="admin-login">
                <h2>Acceso Administrativo MDM</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Usuario</label>
                        <input type="text" id="username" required placeholder="Ingresa tu usuario" value="">
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" id="password" required placeholder="Ingresa tu contraseña" value="">
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">Acceder al Panel MDM</button>
                </form>
                <p style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9rem;">

                </p>
            </div>

            <!-- Panel de Administración MDM -->
            <div class="admin-panel" id="admin-panel">
                <div class="admin-header">
                    <h2>Panel de Control MDM - Celulares JL 
                        <span id="firebase-panel-status" class="firebase-status">Firebase ✅</span>
                    </h2>
                    <button class="btn btn-outline" onclick="logoutAdmin()" style="color: white; border-color: white;">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </button>
                </div>

                <div class="admin-stats">
                    <div class="stat-card">
                        <span class="stat-number" id="total-devices">0</span>
                        <span class="stat-label">Dispositivos Totales</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="active-devices">0</span>
                        <span class="stat-label">Dispositivos Activos</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="blocked-devices">0</span>
                        <span class="stat-label">Dispositivos Bloqueados</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="pending-payments">0</span>
                        <span class="stat-label">Pagos Pendientes</span>
                    </div>
                </div>

                <div class="admin-content">
                    <h3 style="margin-bottom: 20px; color: var(--secondary);">Gestión de Dispositivos MDM</h3>
                    
                    <div class="device-list">
                        <div class="device-header">
                            <div>Cliente / Dispositivo</div>
                            <div>IMEI</div>
                            <div>Estado de Pago</div>
                            <div>Estado MDM</div>
                            <div>Acciones</div>
                        </div>
                        <div id="devices-list">
                            <!-- Los dispositivos se cargarán aquí dinámicamente -->
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 40px;">
                        <div>
                            <h4 style="margin-bottom: 15px; color: var(--secondary);">Registrar Nuevo Dispositivo</h4>
                            <form id="add-device-form">
                                <div class="form-group">
                                    <input type="text" id="client-name" placeholder="Nombre completo del cliente" required>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="device-imei" placeholder="IMEI del dispositivo (15 dígitos)" required maxlength="15">
                                </div>
                                <div class="form-group">
                                    <input type="text" id="device-model" placeholder="Modelo del dispositivo" required>
                                </div>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-plus"></i> Registrar Dispositivo
                                </button>
                            </form>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 15px; color: var(--secondary);">Búsqueda Rápida</h4>
                            <div class="form-group">
                                <input type="text" id="search-device" placeholder="Buscar por IMEI o cliente..." 
                                       onkeyup="searchDevices()">
                            </div>
                            <div id="search-results" style="max-height: 200px; overflow-y: auto;">
                                <!-- Resultados de búsqueda -->
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button class="btn btn-outline" onclick="exportSalesData()" style="width: 100%;">
                                    <i class="fas fa-download"></i> Exportar Datos a Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonios -->
    <section class="testimonials section-padding" id="testimonios">
        <div class="container">
            <h2 class="section-title">Lo Que Dicen Nuestros Clientes</h2>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "Excelente servicio, me aprobaron el crédito en menos de 24 horas y el teléfono llegó perfecto. El sistema MDM me da confianza."
                    </div>
                    <div class="testimonial-author">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Cliente" class="author-avatar">
                        <div class="author-info">
                            <h4>Roberto Sánchez</h4>
                            <p>Cliente desde 2022</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "El proceso fue muy sencillo y las cuotas se ajustan a mi presupuesto. Definitivamente recomiendo Celulares JL por su transparencia."
                    </div>
                    <div class="testimonial-author">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Cliente" class="author-avatar">
                        <div class="author-info">
                            <h4>María González</h4>
                            <p>Cliente desde 2023</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-text">
                        "Tenía mal historial crediticio y en otras tiendas me habían rechazado. En Celulares JL me dieron una oportunidad y ahora tengo el teléfono que quería."
                    </div>
                    <div class="testimonial-author">
                        <img src="https://randomuser.me/api/portraits/men/67.jpg" alt="Cliente" class="author-avatar">
                        <div class="author-info">
                            <h4>Carlos Mendoza</h4>
                            <p>Cliente desde 2023</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contacto">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Celulares JL</h3>
                    <p>Tu tienda de confianza para adquirir celulares a crédito con sistema MDM integrado para tu seguridad.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="#inicio">Inicio</a></li>
                        <li><a href="#productos">Productos</a></li>
                        <li><a href="#credito">Crédito</a></li>
                        <li><a href="#admin">Administración MDM</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contacto</h3>
                    <ul>
                        <li><i class="fas fa-phone"></i> +52 311 106 3251</li>
                        <li><i class="fas fa-envelope"></i> jlcelulares888@gmail.com</li>
                        <li><i class="fas fa-map-marker-alt"></i> Democrito #56, Tepic, Nayarit</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Horario de Atención</h3>
                    <ul>
                        <li>Lunes - Viernes: 9:30 AM - 8:00 PM</li>
                        <li>Sábados: 10:00 AM - 6:00 PM</li>
                        <li>Domingos: 10:00 AM - 6:00 PM</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 Celulares JL. Todos los derechos reservados. | Sistema MDM Integrado</p>
            </div>
        </div>
    </footer>

    <script>
        // ========== DATOS DE PRODUCTOS ==========
        const products = [
            {
                id: 1,
                name: "iPhone 14 Pro",
                price: 1299,
                brand: "apple",
                image: "https://www.att.com.mx/dw/image/v2/BJKW_PRD/on/demandware.static/-/Sites-att-master/default/dw75e48dd6/images/Devices/Apple/Iphone%2014%20Pro/iPhone_14_Pro_Space_Black_PDP_Image_Position-1a_MXLA.jpg?sw=400&sh=400&sm=fit",
                description: "El último iPhone con Dynamic Island y cámara de 48MP.",
                features: ["Pantalla Super Retina XDR", "Chip A16 Bionic", "Cámara Pro de 48 MP", "Hasta 28 horas de video"]
            },
            {
                id: 2,
                name: "Samsung Galaxy S23",
                price: 999,
                brand: "samsung",
                image: "https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
                description: "Potente smartphone Android con excelente cámara y rendimiento.",
                features: ["Pantalla Dynamic AMOLED 2X", "Snapdragon 8 Gen 2", "Cámara de 50 MP", "Batería de 3900 mAh"]
            },
            {
                id: 3,
                name: "Google Pixel 7",
                price: 799,
                brand: "google",
                image: "https://cdn-files.kimovil.com/default/0007/85/thumb_684812_default_big.jpg",
                description: "Experiencia Android pura con la mejor cámara del mercado.",
                features: ["Pantalla OLED", "Tensor G2", "Cámara de 50 MP", "Android 13"]
            },
            {
                id: 4,
                name: "OnePlus 11",
                price: 899,
                brand: "oneplus",
                image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR1xXbunCgiTx5bHPCn50HcWSe28_JjxqaaFg&s",
                description: "Rendimiento excepcional y carga ultrarrápida.",
                features: ["Pantalla Fluid AMOLED", "Snapdragon 8 Gen 2", "Cámara Hasselblad", "Carga de 100W"]
            },
            {
                id: 5,
                name: "Xiaomi 13",
                price: 749,
                brand: "xiaomi",
                image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTwqPsP4l4FHGWiUO0tE_QHmof8_HjIHl3G18ApEhOTJuROT5iPedK3CytjmCkvA5PuNVs&usqp=CAU",
                description: "Excelente relación calidad-precio con características premium.",
                features: ["Pantalla AMOLED", "Snapdragon 8 Gen 2", "Cámara Leica", "Batería de 4500 mAh"]
            },
            {
                id: 6,
                name: "Motorola Edge 40 neo",
                price: 599,
                brand: "motorola",
                image: "https://i5.walmartimages.com.mx/gr/images/product-images/img_large/00084002325809L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF",
                description: "Pantalla curva y batería de larga duración.",
                features: ["Pantalla pOLED 144Hz", "MediaTek Dimensity 7030", "Cámara de 50 MP", "Batería de 5000 mAh"]
            }
        ];

        // ========== VARIABLES GLOBALES ==========
        let currentSaleData = null;
        let documents = {
            ineFront: null,
            ineBack: null,
            addressProof: null,
            selfie: null
        };
        let devices = [];
        let firebaseReady = false;

        // ========== FUNCIONES DE DOCUMENTOS ==========

        function goBackToCalculator() {
            document.getElementById('documentos').style.display = 'none';
        }

        function validateFile(file) {
            const maxSize = 5 * 1024 * 1024; // 5MB
            const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
            
            if (!allowedTypes.includes(file.type)) {
                alert('❌ Formato de archivo no permitido. Solo se aceptan JPG, PNG o PDF.');
                return false;
            }
            
            if (file.size > maxSize) {
                alert('❌ El archivo es demasiado grande. El tamaño máximo es 5MB.');
                return false;
            }
            
            return true;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getFileExtension(filename) {
            return filename.split('.').pop().toLowerCase();
        }

        function removeDocument(inputId, previewId) {
            // Resetear input
            document.getElementById(inputId).value = '';
            
            // Eliminar previsualización
            if (previewId.includes('preview')) {
                document.getElementById(previewId).innerHTML = '';
                document.getElementById(previewId).parentElement.style.display = 'none';
            }
            
            // Eliminar del objeto documents
            if (inputId === 'ine-front') documents.ineFront = null;
            else if (inputId === 'ine-back') documents.ineBack = null;
            else if (inputId === 'address-proof') documents.addressProof = null;
            else if (inputId === 'selfie') documents.selfie = null;
        }

        // ========== SISTEMA MDM CON FIREBASE ==========

        // Verificar estado de Firebase
        function checkFirebaseStatus() {
            if (window.firestoreDB) {
                firebaseReady = true;
                document.getElementById('firebase-status').textContent = 'Conectado a Firebase';
                document.getElementById('firebase-panel-status').textContent = 'Firebase ✅';
                console.log("✅ Firebase conectado correctamente");
                
                // Cargar dispositivos automáticamente si está logueado
                if (document.getElementById('admin-panel').style.display === 'block') {
                    loadDevicesList();
                }
            } else {
                firebaseReady = false;
                document.getElementById('firebase-status').textContent = 'Modo Local';
                document.getElementById('firebase-status').classList.add('firebase-offline');
                document.getElementById('firebase-panel-status').textContent = 'Modo Local ⚠️';
                console.log("⚠️ Usando almacenamiento local");
            }
        }

        // ========== FUNCIONES FIREBASE ==========

        // Función para guardar dispositivo en Firebase
        async function saveDeviceToFirebase(deviceData) {
            if (!firebaseReady) return null;
            
            try {
                const deviceRef = firebaseModules.doc(firestoreDB, "devices", deviceData.imei);
                
                await firebaseModules.setDoc(deviceRef, {
                    imei: deviceData.imei,
                    model: deviceData.model,
                    status: "active",
                    clientName: deviceData.clientName,
                    paymentStatus: "al día",
                    lastPayment: new Date().toISOString().split('T')[0],
                    created: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                });
                
                console.log("✅ Dispositivo guardado en Firebase");
                return deviceData.imei;
            } catch (error) {
                console.error("❌ Error guardando en Firebase:", error);
                return null;
            }
        }

        // Función para cargar dispositivos desde Firebase
        async function loadDevicesFromFirebase() {
            if (!firebaseReady) return [];
            
            try {
                const querySnapshot = await firebaseModules.getDocs(
                    firebaseModules.collection(firestoreDB, "devices")
                );
                
                const firebaseDevices = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    firebaseDevices.push({ 
                        firebaseId: doc.id, 
                        clientName: data.clientName || '',
                        imei: data.imei || doc.id,
                        model: data.model || 'Desconocido',
                        status: data.status || 'active',
                        paymentStatus: data.paymentStatus || 'al día',
                        lastPayment: data.lastPayment || new Date().toISOString().split('T')[0],
                        created: data.created || new Date().toISOString()
                    });
                });
                
                console.log("✅ Dispositivos cargados desde Firebase:", firebaseDevices.length);
                return firebaseDevices;
            } catch (error) {
                console.error("❌ Error cargando desde Firebase:", error);
                return [];
            }
        }

        // ========== FUNCIONES MDM PRINCIPALES ==========

        async function blockDevice(deviceId) {
            try {
                const device = findDeviceById(deviceId);
                if (!device) {
                    alert('❌ Dispositivo no encontrado');
                    return;
                }
                
                if (confirm(`¿Estás seguro de BLOQUEAR el dispositivo?\n\nCliente: ${device.clientName}\nIMEI: ${device.imei}`)) {
                    if (device.firebaseId && firebaseReady) {
                        const updateData = {
                            status: 'blocked',
                            lastUpdated: new Date().toISOString()
                        };
                        
                        await firebaseModules.updateDoc(
                            firebaseModules.doc(firestoreDB, "devices", device.firebaseId),
                            updateData
                        );
                    }
                    
                    device.status = 'blocked';
                    saveToLocalStorage();
                    await loadDevicesList();
                    updateStats();
                    
                    alert(`📵 DISPOSITIVO BLOQUEADO\n\nCliente: ${device.clientName}\nIMEI: ${device.imei}`);
                }
            } catch (error) {
                console.error('Error bloqueando dispositivo:', error);
                alert('❌ Error al bloquear el dispositivo');
            }
        }

        async function unblockDevice(deviceId) {
            try {
                const device = findDeviceById(deviceId);
                if (!device) {
                    alert('❌ Dispositivo no encontrado');
                    return;
                }
                
                if (confirm(`¿Estás seguro de DESBLOQUEAR el dispositivo?\n\nIMEI: ${device.imei}`)) {
                    if (device.firebaseId && firebaseReady) {
                        const updateData = {
                            status: 'active',
                            lastUpdated: new Date().toISOString()
                        };
                        
                        await firebaseModules.updateDoc(
                            firebaseModules.doc(firestoreDB, "devices", device.firebaseId),
                            updateData
                        );
                    }
                    
                    device.status = 'active';
                    saveToLocalStorage();
                    await loadDevicesList();
                    updateStats();
                    
                    alert(`✅ DISPOSITIVO DESBLOQUEADO\n\nIMEI: ${device.imei}`);
                }
            } catch (error) {
                console.error('Error desbloqueando dispositivo:', error);
                alert('❌ Error al desbloquear el dispositivo');
            }
        }

        // ========== CÓDIGO PRINCIPAL ==========

        document.addEventListener('DOMContentLoaded', function() {
            const productsContainer = document.getElementById('products-container');
            const productSelect = document.getElementById('product');
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            // Verificar estado de Firebase
            setTimeout(checkFirebaseStatus, 1000);
            
            // Función para renderizar productos
            function renderProducts(filter = 'all') {
                productsContainer.innerHTML = '';
                
                const filteredProducts = filter === 'all' 
                    ? products 
                    : products.filter(product => product.brand === filter);
                
                filteredProducts.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div style="position: relative;">
                            <img src="${product.image}" alt="${product.name}" class="product-img">
                            <span class="product-badge">Nuevo</span>
                        </div>
                        <div class="product-info">
                            <h3 class="product-title">${product.name}</h3>
                            <p class="product-price">$${product.price}</p>
                            <p class="product-description">${product.description}</p>
                            <ul class="product-features">
                                ${product.features.map(feature => `<li><i class="fas fa-check"></i> ${feature}</li>`).join('')}
                            </ul>
                            <button class="btn btn-accent" data-product-id="${product.id}">Financiar Ahora</button>
                        </div>
                    `;
                    productsContainer.appendChild(productCard);
                });
            }
            
            // Llenar selector de productos en el formulario
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} - $${product.price}`;
                productSelect.appendChild(option);
            });
            
            // Renderizar todos los productos inicialmente
            renderProducts();
            
            // Manejar filtros de productos
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    renderProducts(this.getAttribute('data-filter'));
                });
            });
            
            // Manejar el formulario de cálculo de crédito
            document.getElementById('credit-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateCredit();
            });
            
            // Manejar clic en botones de financiar
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-accent')) {
                    const productId = e.target.getAttribute('data-product-id');
                    document.getElementById('product').value = productId;
                    document.getElementById('credito').scrollIntoView({ behavior: 'smooth' });
                }
            });

            // ========== SISTEMA DE LOGIN MDM ==========
            document.getElementById('login-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                const ADMIN_CREDENTIALS = {
                    username: 'admin',
                    password: '1234'
                };
                
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    document.getElementById('admin-login').style.display = 'none';
                    document.getElementById('admin-panel').style.display = 'block';
                    await loadAdminPanel();
                } else {
                    alert('❌ Usuario o contraseña incorrectos\n\nContacta al administrador del sistema.');
                }
            });

            // ========== FORMULARIO AGREGAR DISPOSITIVO ==========
            document.getElementById('add-device-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const clientName = document.getElementById('client-name').value;
                const imei = document.getElementById('device-imei').value;
                const model = document.getElementById('device-model').value;
                
                if (imei.length !== 15 || !/^\d+$/.test(imei)) {
                    alert('❌ El IMEI debe tener exactamente 15 dígitos numéricos');
                    return;
                }
                
                const existingDevice = devices.find(d => d.imei === imei);
                if (existingDevice) {
                    alert(`❌ El IMEI ${imei} ya está registrado\nCliente: ${existingDevice.clientName}`);
                    return;
                }
                
                const newDevice = {
                    clientName: clientName,
                    imei: imei,
                    model: model,
                    status: "active",
                    paymentStatus: "al día",
                    lastPayment: new Date().toISOString().split('T')[0],
                    created: new Date().toISOString()
                };
                
                const firebaseId = await saveDeviceToFirebase(newDevice);
                
                if (firebaseId) {
                    newDevice.firebaseId = firebaseId;
                    devices.push(newDevice);
                    alert(`✅ Dispositivo registrado exitosamente\n\nCliente: ${clientName}\nIMEI: ${imei}\nModelo: ${model}`);
                } else {
                    newDevice.id = 'local_' + Date.now();
                    devices.push(newDevice);
                    saveToLocalStorage();
                    alert(`⚠️ Dispositivo registrado en modo local\n\nCliente: ${clientName}\nIMEI: ${imei}`);
                }
                
                await loadDevicesList();
                updateStats();
                document.getElementById('add-device-form').reset();
            });

            // ========== CONFIGURAR EVENTOS DE SUBIDA DE DOCUMENTOS ==========
            setupDocumentUploads();

            // ========== FORMULARIO DE DOCUMENTOS ==========
            document.getElementById('document-upload-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                await submitDocuments();
            });
        });

        function setupDocumentUploads() {
            setupUploadArea('ine-upload-area', handleINEUpload);
            setupUploadArea('address-upload-area', handleAddressUpload);
            setupUploadArea('selfie-upload-area', handleSelfieUpload);
        }

        function setupUploadArea(areaId, handler) {
            const area = document.getElementById(areaId);
            const fileInput = area.querySelector('input[type="file"]');
            
            area.addEventListener('click', () => fileInput.click());
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.style.borderColor = '#2ecc71';
                area.style.background = 'rgba(46, 204, 113, 0.1)';
            });
            
            area.addEventListener('dragleave', () => {
                area.style.borderColor = 'var(--primary)';
                area.style.background = 'rgba(52, 152, 219, 0.05)';
            });
            
            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.style.borderColor = 'var(--primary)';
                area.style.background = 'rgba(52, 152, 219, 0.05)';
                
                if (e.dataTransfer.files.length) {
                    handler(e.dataTransfer.files[0], fileInput.id);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handler(e.target.files[0], fileInput.id);
                }
            });
        }

        function handleINEUpload(file, inputId) {
            if (!validateFile(file)) return;
            
            const isFront = inputId === 'ine-front';
            const previewId = isFront ? 'ine-front-preview' : 'ine-back-preview';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewContainer = document.getElementById('ine-preview');
                previewContainer.style.display = 'block';
                
                let previewDiv = document.getElementById(previewId);
                if (!previewDiv) {
                    previewDiv = document.createElement('div');
                    previewDiv.id = previewId;
                    previewContainer.querySelector('.preview-images').appendChild(previewDiv);
                }
                
                previewDiv.innerHTML = `
                    <img src="${e.target.result}" alt="${isFront ? 'INE Frente' : 'INE Reverso'}">
                    <div class="file-info">
                        <p><strong>${isFront ? 'INE (Frente)' : 'INE (Reverso)'}</strong></p>
                        <p>${formatFileSize(file.size)}</p>
                        <button type="button" class="btn btn-sm btn-outline" onclick="removeDocument('${inputId}', '${previewId}')" style="margin-top: 5px;">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                `;
                
                documents[isFront ? 'ineFront' : 'ineBack'] = {
                    file: file,
                    dataUrl: e.target.result,
                    name: `${isFront ? 'INE_Frente_' : 'INE_Reverso_'}${Date.now()}.${getFileExtension(file.name)}`
                };
            };
            
            reader.readAsDataURL(file);
        }

        function handleAddressUpload(file, inputId) {
            if (!validateFile(file)) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewContainer = document.getElementById('address-preview');
                previewContainer.style.display = 'block';
                previewContainer.innerHTML = `
                    <img src="${e.target.result}" alt="Comprobante de Domicilio">
                    <div class="file-info">
                        <p><strong>Comprobante de Domicilio</strong></p>
                        <p>${formatFileSize(file.size)}</p>
                        <button type="button" class="btn btn-sm btn-outline" onclick="removeDocument('${inputId}', 'address-preview')" style="margin-top: 5px;">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                `;
                
                documents.addressProof = {
                    file: file,
                    dataUrl: e.target.result,
                    name: `Comprobante_Domicilio_${Date.now()}.${getFileExtension(file.name)}`
                };
            };
            
            reader.readAsDataURL(file);
        }

        function handleSelfieUpload(file, inputId) {
            if (!validateFile(file)) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewContainer = document.getElementById('selfie-preview');
                previewContainer.style.display = 'block';
                previewContainer.innerHTML = `
                    <img src="${e.target.result}" alt="Selfie con INE">
                    <div class="file-info">
                        <p><strong>Selfie con INE</strong></p>
                        <p>${formatFileSize(file.size)}</p>
                        <button type="button" class="btn btn-sm btn-outline" onclick="removeDocument('${inputId}', 'selfie-preview')" style="margin-top: 5px;">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                `;
                
                documents.selfie = {
                    file: file,
                    dataUrl: e.target.result,
                    name: `Selfie_INE_${Date.now()}.${getFileExtension(file.name)}`
                };
            };
            
            reader.readAsDataURL(file);
        }

        // ========== FUNCIONES MDM COMPLEMENTARIAS ==========

        async function loadAdminPanel() {
            await loadDevicesList();
            updateStats();
        }

        async function loadDevicesList() {
            try {
                const firebaseDevices = await loadDevicesFromFirebase();
                
                if (firebaseDevices.length > 0) {
                    devices = firebaseDevices;
                    console.log("📱 Dispositivos cargados desde Firebase");
                } else {
                    devices = loadFromLocalStorage();
                    console.log("📱 Dispositivos cargados desde almacenamiento local");
                }
                
                renderDevicesList();
                updateStats();
            } catch (error) {
                console.error("Error cargando dispositivos:", error);
                devices = loadFromLocalStorage();
                renderDevicesList();
                updateStats();
            }
        }

        function renderDevicesList() {
            const devicesList = document.getElementById('devices-list');
            devicesList.innerHTML = '';
            
            if (devices.length === 0) {
                devicesList.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #666;">
                        <i class="fas fa-mobile-alt" style="font-size: 3rem; margin-bottom: 15px; color: #ddd;"></i>
                        <p>No hay dispositivos registrados aún.</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Usa el formulario para registrar el primer dispositivo.</p>
                    </div>
                `;
                return;
            }
            
            devices.forEach(device => {
                const deviceItem = document.createElement('div');
                deviceItem.className = 'device-item';
                deviceItem.innerHTML = `
                    <div>
                        <strong style="color: #2c3e50;">${device.clientName}</strong><br>
                        <small style="color: #666;">${device.model}</small>
                    </div>
                    <div style="font-family: monospace; font-weight: 600; color: #2c3e50;">${device.imei}</div>
                    <div>
                        <span class="status-badge ${device.paymentStatus === 'al día' ? 'status-active' : 'status-blocked'}">
                            ${device.paymentStatus}
                        </span>
                    </div>
                    <div>
                        <span class="status-badge ${device.status === 'active' ? 'status-active' : 'status-blocked'}">
                            ${device.status === 'active' ? 'ACTIVO' : 'BLOQUEADO'}
                        </span>
                    </div>
                    <div>
                        ${device.status === 'active' 
                            ? `<button class="btn btn-accent btn-sm" onclick="blockDevice('${device.firebaseId || device.id}')">
                                  <i class="fas fa-lock"></i> Bloquear
                               </button>`
                            : `<button class="btn btn-success btn-sm" onclick="unblockDevice('${device.firebaseId || device.id}')">
                                  <i class="fas fa-unlock"></i> Desbloquear
                               </button>`
                        }
                        <button class="btn btn-outline btn-sm" onclick="deleteDevice('${device.firebaseId || device.id}')" style="margin-left: 5px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                devicesList.appendChild(deviceItem);
            });
        }

        function updateStats() {
            const total = devices.length;
            const active = devices.filter(d => d.status === 'active').length;
            const blocked = devices.filter(d => d.status === 'blocked').length;
            const pending = devices.filter(d => d.paymentStatus === 'atrasado').length;
            
            document.getElementById('total-devices').textContent = total;
            document.getElementById('active-devices').textContent = active;
            document.getElementById('blocked-devices').textContent = blocked;
            document.getElementById('pending-payments').textContent = pending;
        }

        async function deleteDevice(deviceId) {
            try {
                const device = findDeviceById(deviceId);
                if (!device) {
                    alert('❌ Dispositivo no encontrado');
                    return;
                }
                
                if (confirm(`¿Estás seguro de ELIMINAR este dispositivo?\n\nCliente: ${device.clientName}\nIMEI: ${device.imei}`)) {
                    if (device.firebaseId) {
                        try {
                            await firebaseModules.deleteDoc(
                                firebaseModules.doc(firestoreDB, "devices", device.firebaseId)
                            );
                        } catch (error) {
                            console.error("Error eliminando de Firebase:", error);
                        }
                    }
                    
                    devices = devices.filter(d => (d.firebaseId || d.id) !== deviceId);
                    saveToLocalStorage();
                    await loadDevicesList();
                    updateStats();
                    
                    alert('✅ Dispositivo eliminado exitosamente');
                }
            } catch (error) {
                console.error('Error eliminando dispositivo:', error);
                alert('❌ Error al eliminar el dispositivo');
            }
        }

        function findDeviceById(deviceId) {
            return devices.find(d => {
                const idToCompare = d.firebaseId || d.id;
                return idToCompare === deviceId;
            });
        }

        function searchDevices() {
            const searchTerm = document.getElementById('search-device').value.toLowerCase();
            const results = devices.filter(device => 
                device.clientName.toLowerCase().includes(searchTerm) || 
                device.imei.includes(searchTerm) ||
                device.model.toLowerCase().includes(searchTerm)
            );
            
            const resultsDiv = document.getElementById('search-results');
            if (searchTerm.length > 0 && results.length > 0) {
                resultsDiv.innerHTML = results.map(device => `
                    <div style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer;" 
                         onclick="document.getElementById('search-device').value='${device.imei}'; document.getElementById('search-results').innerHTML='';">
                        <strong>${device.clientName}</strong> - ${device.model}<br>
                        <small>IMEI: ${device.imei} | Estado: <span class="${device.status === 'active' ? 'status-active' : 'status-blocked'}" style="padding: 2px 6px; border-radius: 10px; font-size: 0.7rem;">${device.status}</span></small>
                    </div>
                `).join('');
            } else if (searchTerm.length > 0) {
                resultsDiv.innerHTML = '<div style="padding: 10px; color: #666; text-align: center;">No se encontraron dispositivos</div>';
            } else {
                resultsDiv.innerHTML = '';
            }
        }

        function logoutAdmin() {
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('login-form').reset();
        }

        // ========== FUNCIONES DE ALMACENAMIENTO LOCAL ==========

        function saveToLocalStorage() {
            localStorage.setItem('celularesjl_devices', JSON.stringify(devices));
        }

        function loadFromLocalStorage() {
            const localDevices = JSON.parse(localStorage.getItem('celularesjl_devices')) || [];
            return localDevices;
        }

        // ========== FUNCIONES DE EXPORTACIÓN ==========

        function exportSalesData() {
            const salesData = devices.map(device => ({
                'Cliente': device.clientName,
                'Modelo': device.model,
                'IMEI': device.imei,
                'Estado MDM': device.status,
                'Estado de Pago': device.paymentStatus,
                'Último Pago': device.lastPayment,
                'Fecha Registro': device.created
            }));
            
            let csv = 'Cliente,Modelo,IMEI,Estado MDM,Estado de Pago,Último Pago,Fecha Registro\n';
            salesData.forEach(row => {
                csv += `"${row.Cliente}","${row.Modelo}","${row.IMEI}","${row['Estado MDM']}","${row['Estado de Pago']}","${row['Último Pago']}","${row['Fecha Registro']}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', `dispositivos-celularesjl-${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            alert('✅ Datos exportados exitosamente');
        }

        // ========== CALCULADORA DE CRÉDITO ==========

        function calculateCredit() {
            const productId = document.getElementById('product').value;
            const months = parseInt(document.getElementById('months').value);
            const initialPayment = parseFloat(document.getElementById('initial-payment').value) || 0;
            
            if (!productId) {
                alert('Por favor selecciona un producto');
                return;
            }
            
            const product = products.find(p => p.id == productId);
            const totalAmount = product.price - initialPayment;
            const interestRate = 0.15;
            const monthlyRate = interestRate / 12;
            
            const monthlyPayment = totalAmount * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
            
            const resultDiv = document.getElementById('calculator-result');
            resultDiv.innerHTML = `
                <h3>Resumen de Financiamiento</h3>
                <div class="result-item">
                    <span>Producto:</span>
                    <span>${product.name}</span>
                </div>
                <div class="result-item">
                    <span>Precio:</span>
                    <span>$${product.price}</span>
                </div>
                <div class="result-item">
                    <span>Pago inicial:</span>
                    <span>$${initialPayment}</span>
                </div>
                <div class="result-item">
                    <span>Plazo:</span>
                    <span>${months} meses</span>
                </div>
                <div class="result-item">
                    <span>Tasa de interés:</span>
                    <span>${(interestRate * 100).toFixed(1)}% anual</span>
                </div>
                <div class="result-item">
                    <span>Cuota mensual:</span>
                    <span>$${monthlyPayment.toFixed(2)}</span>
                </div>
                <div class="result-item">
                    <span>Total a pagar:</span>
                    <span>$${(monthlyPayment * months).toFixed(2)}</span>
                </div>
                <div class="result-item">
                    <span>Intereses:</span>
                    <span>$${((monthlyPayment * months) - totalAmount).toFixed(2)}</span>
                </div>
                <div class="result-total">
                    <span>Total financiado:</span>
                    <span>$${totalAmount.toFixed(2)}</span>
                </div>
                <button class="btn" style="margin-top: 20px; width: 100%;" onclick="saveSale({
                    product: '${product.name}',
                    price: ${product.price},
                    months: ${months},
                    initialPayment: ${initialPayment},
                    monthlyPayment: ${monthlyPayment.toFixed(2)},
                    totalAmount: ${totalAmount.toFixed(2)}
                })">Solicitar Este Crédito</button>
            `;
        }

        // ========== FUNCIONES DE VENTA Y DOCUMENTOS ==========

        async function saveSale(saleData) {
            currentSaleData = saleData;
            
            document.getElementById('sale-details').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div><strong>Producto:</strong> ${saleData.product}</div>
                    <div><strong>Precio:</strong> $${saleData.price}</div>
                    <div><strong>Pago inicial:</strong> $${saleData.initialPayment}</div>
                    <div><strong>Plazo:</strong> ${saleData.months} meses</div>
                    <div><strong>Cuota mensual:</strong> $${saleData.monthlyPayment}</div>
                    <div><strong>Total a pagar:</strong> $${(saleData.monthlyPayment * saleData.months).toFixed(2)}</div>
                </div>
            `;
            
            document.getElementById('documentos').style.display = 'block';
            document.getElementById('documentos').scrollIntoView({ behavior: 'smooth' });
        }

        async function submitDocuments() {
            // Validar documentos requeridos
            if (!documents.ineFront || !documents.addressProof || !documents.selfie) {
                alert('❌ Por favor sube todos los documentos requeridos: INE (frente y reverso), comprobante de domicilio y selfie con INE.');
                return;
            }
            
            // Validar información personal
            const clientInfo = {
                fullname: document.getElementById('client-fullname').value,
                phone: document.getElementById('client-phone').value,
                email: document.getElementById('client-email').value,
                curp: document.getElementById('client-curp').value,
                address: document.getElementById('client-address').value
            };
            
            if (!clientInfo.fullname || !clientInfo.phone || !clientInfo.email || !clientInfo.address) {
                alert('❌ Por favor completa todos los campos obligatorios de información personal.');
                return;
            }
            
            // Mostrar overlay de procesamiento
            showProcessingOverlay();
            
            try {
                // Crear registro en Firebase
                const saleRecord = {
                    ...currentSaleData,
                    clientInfo: clientInfo,
                    documents: {
                        ineFront: documents.ineFront ? true : false,
                        ineBack: documents.ineBack ? true : false,
                        addressProof: documents.addressProof ? true : false,
                        selfie: documents.selfie ? true : false
                    },
                    status: 'pending_documents',
                    timestamp: new Date().toISOString(),
                    ip: await getClientIP()
                };
                
                let saleId = '';
                if (firebaseReady) {
                    try {
                        const docRef = await firebaseModules.addDoc(
                            firebaseModules.collection(firestoreDB, "credit_applications"),
                            saleRecord
                        );
                        saleId = docRef.id;
                        console.log("✅ Solicitud guardada en Firebase:", saleId);
                    } catch (firebaseError) {
                        console.error("❌ Error guardando en Firebase:", firebaseError);
                        saleId = 'local_' + Date.now();
                    }
                }
                
                // Enviar correo con EmailJS
                await sendEmailWithDocuments(saleRecord, saleId, clientInfo);
                
                // Resetear formulario
                resetDocumentForm();
                
                // Mostrar confirmación
                hideProcessingOverlay();
                showSuccessMessage(saleId);
                
            } catch (error) {
                console.error("❌ Error procesando documentos:", error);
                hideProcessingOverlay();
                alert('❌ Error al procesar la solicitud. Por favor intenta nuevamente o contacta directamente al teléfono de la tienda.');
            }
        }

        async function sendEmailWithDocuments(saleRecord, saleId, clientInfo) {
            const templateParams = {
                to_email: "jlcelulares888@gmail.com",
                from_name: "Sistema de Crédito Celulares JL",
                sale_id: saleId,
                client_name: clientInfo.fullname,
                client_phone: clientInfo.phone,
                client_email: clientInfo.email,
                client_address: clientInfo.address,
                client_curp: clientInfo.curp,
                product_name: saleRecord.product,
                product_price: `$${saleRecord.price}`,
                initial_payment: `$${saleRecord.initialPayment}`,
                months: saleRecord.months,
                monthly_payment: `$${saleRecord.monthlyPayment}`,
                total_amount: `$${(saleRecord.monthlyPayment * saleRecord.months).toFixed(2)}`,
                timestamp: new Date().toLocaleString('es-MX'),
                ip_address: saleRecord.ip,
                documents_count: `${Object.values(documents).filter(doc => doc !== null).length}/4 documentos subidos`
            };
            
            try {
                // Enviar correo a la empresa (usando tu Service ID)
                await emailjs.send(
                    "service_fwhlfmm",  // Tu Service ID de EmailJS
                    "template_8p54gr8",  // Template ID que crearás en EmailJS
                    templateParams
                );
                
                console.log("✅ Correo enviado exitosamente a jlcelulares888@gmail.com");
                
                // Enviar correo de confirmación al cliente
                const clientTemplateParams = {
                    to_email: clientInfo.email,
                    client_name: clientInfo.fullname,
                    product_name: saleRecord.product,
                    reference_number: saleId,
                    empresa_email: "jlcelulares888@gmail.com",
                    empresa_telefono: "+52 311 106 3251"
                };
                
                await emailjs.send(
                    "service_fwhlfmm",
                    "template_rt3p7vh",
                    clientTemplateParams
                );
                
                console.log("✅ Correo de confirmación enviado al cliente");
                
            } catch (emailError) {
                console.error("❌ Error enviando correo:", emailError);
                // Fallback: crear enlace mailto
                sendEmailFallback(saleRecord, clientInfo, saleId);
            }
        }

        function sendEmailFallback(saleRecord, clientInfo, saleId) {
            const subject = `Nueva Solicitud de Crédito - ${saleRecord.product} - Ref: ${saleId}`;
            const body = `
NUEVA SOLICITUD DE CRÉDITO - CELULARES JL

INFORMACIÓN DEL CLIENTE:
• Nombre: ${clientInfo.fullname}
• Teléfono: ${clientInfo.phone}
• Correo: ${clientInfo.email}
• Dirección: ${clientInfo.address}
• CURP: ${clientInfo.curp}

INFORMACIÓN DEL PRODUCTO:
• Producto: ${saleRecord.product}
• Precio: $${saleRecord.price}
• Pago Inicial: $${saleRecord.initialPayment}
• Plazo: ${saleRecord.months} meses
• Cuota Mensual: $${saleRecord.monthlyPayment}
• Total a Pagar: $${(saleRecord.monthlyPayment * saleRecord.months).toFixed(2)}

Fecha: ${new Date().toLocaleString('es-MX')}
Número de Referencia: ${saleId}

LOS DOCUMENTOS ESTÁN ADJUNTOS EN EL SISTEMA MDM.

Revisa el panel de administración para ver los documentos.
            `;
            
            const mailtoLink = `mailto:jlcelulares888@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(mailtoLink, '_blank');
            
            return true;
        }

        function showProcessingOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'processing-overlay';
            overlay.className = 'processing-overlay';
            overlay.innerHTML = `
                <div class="processing-content">
                    <div class="spinner" style="margin: 0 auto 20px; width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <h3 style="margin-bottom: 15px; color: var(--secondary);">Procesando tu solicitud</h3>
                    <p>Estamos enviando tus documentos y procesando tu crédito...</p>
                    <div class="upload-progress">
                        <div class="progress-bar" id="upload-progress-bar"></div>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 20px;">
                        <i class="fas fa-info-circle"></i> Esto puede tomar unos segundos
                    </p>
                </div>
            `;
            
            document.body.appendChild(overlay);
            overlay.style.display = 'flex';
            
            // Animación de progreso
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                const progressBar = document.getElementById('upload-progress-bar');
                if (progressBar) progressBar.style.width = progress + '%';
                
                if (progress >= 90) clearInterval(interval);
            }, 300);
        }

        function hideProcessingOverlay() {
            const overlay = document.getElementById('processing-overlay');
            if (overlay) overlay.remove();
        }

        function showSuccessMessage(saleId) {
            const successHTML = `
                <div class="success-message">
                    <div style="background: #2ecc71; color: white; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 2rem;">
                        <i class="fas fa-check"></i>
                    </div>
                    <h2 style="color: var(--secondary); margin-bottom: 15px;">¡Solicitud Enviada Exitosamente!</h2>
                    <p style="color: #666; margin-bottom: 20px;">
                        Hemos recibido tu solicitud de crédito para el <strong>${currentSaleData.product}</strong>.
                        Tu número de referencia es: <strong>${saleId}</strong>
                    </p>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                        <p><strong>📧 Correo de confirmación:</strong></p>
                        <p>Hemos enviado un correo de confirmación a <strong>${document.getElementById('client-email').value}</strong></p>
                        <p><strong>📞 Proceso siguiente:</strong></p>
                        <p>Nos pondremos en contacto contigo en las próximas 24-48 horas para finalizar tu crédito.</p>
                    </div>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 30px;">
                        <i class="fas fa-clock"></i> Tiempo estimado de respuesta: 24-48 horas hábiles
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="btn" onclick="location.reload()">
                            <i class="fas fa-home"></i> Volver al Inicio
                        </button>
                        <button class="btn btn-outline" onclick="window.print()">
                            <i class="fas fa-print"></i> Imprimir Resumen
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('documentos').innerHTML = successHTML;
        }

        function resetDocumentForm() {
            documents = {
                ineFront: null,
                ineBack: null,
                addressProof: null,
                selfie: null
            };
            
            document.getElementById('document-upload-form').reset();
            document.getElementById('client-fullname').value = '';
            document.getElementById('client-phone').value = '';
            document.getElementById('client-email').value = '';
            document.getElementById('client-curp').value = '';
            document.getElementById('client-address').value = '';
            
            document.getElementById('ine-preview').style.display = 'none';
            document.getElementById('ine-preview').innerHTML = '<div class="preview-images" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;"></div>';
            document.getElementById('address-preview').style.display = 'none';
            document.getElementById('selfie-preview').style.display = 'none';
        }

        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'No disponible';
            }
        }
    </script>
</body>
</html>
